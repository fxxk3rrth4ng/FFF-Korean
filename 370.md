# Friday Facts #370

## 2022-09-23, [Twinsen](https://factorio.com/blog/author/Twinsen), [kovarex](https://factorio.com/blog/author/kovarex)

[원문 확인하기](https://factorio.com/blog/post/fff-370)

---


저희는 팩토리오를 콘솔과 모바일을 포함한 다른 플랫폼으로 옮기려는 시도를 오랫동안 해왔습니다. ([만우절](./132.md)은 제외하고요.) 저희는 심지어 몇몇 외부 회사와도 작업을 했지만, 프로젝트는 컨트롤러나 터치스크린으로 플레이할 수 있는 것은 말할 것도 없고 기술적으로 실행하는데에도 도달하지 못했습니다. 그런 시도 끝에, 저희는 심지어 "다른 플랫폼으로의 이식 계획은 없다"는 내용의 Friday Facts까지 준비를 했었습니다.

---

### Nintendo Switch로의 여정 (kovarex)

저는 Nintendo Switch 시스템, 특히 탈착하여 각각 한 손에 쥘 수 있는 Joy-Con 컨트롤러의 굉장한 팬입니다. 팩토리오를 Nintendo Switch로 옮기는 것은 제가 오랫동안 마음에 담아두고 있었던 것이었죠. 2021년 2월 즈음에 저희가 팀의 미래와 다음에 작업할 것을 논의하고 있을 때, 저는 Nintendo Switch로 옮기는 것을 결정했습니다. 그리고 기초 조사 끝에, 그것은 그렇게 오래 걸릴 것 같지 않아보였습니다. 

이야기를 진행하기 이전에, 저는 프로젝트가 알 수 없는 것들로 가득했다는 점을 설명하고 싶고, 그것들은 다음과 같습니다. 

* 그래픽 백엔드를 갈아엎지 않고도 기술적 포팅이 가능한가?
* Nintendo Switch의 시스템이 적정한 성능을 유지하며 게임을 구동할 수 있는가?
* 게임을 컨트롤러로 플레이할 수 있는가?
* 프로젝트가 너무 크진 않은가?

저희는 팩토리오 관련된 부프로젝트들을 시작했다 수년간의 개발 지옥에 빠져 끝난 적이 있기 때문에, 저의 이 프로젝트에서의 목표는 부분들이 그저 빠르고 더러운 프로토타입이 아니라는 것을 보이는 것에 최선을 다하면서 항상 빠르게 실패하는 것이었습니다. 만약 위와 같은 질문에 대한 답이 명확하게 아니라면 프로젝트는 취소될 것이었고, 아슬아슬 했던 적도 있었습니다 :)

### 컴파일 그리고 첫 가동

그래서 우리는 개발자 액세스를 신청했고 빨리 얻었습니다. 그리고 첫 번째 문제는 앞에 있었습니다. 과연 팩토리오를 Nintendo Switch용으로 컴파일할 수 있을까? 특히 저희는 맞춤형 [FASTBuild](https://www.fastbuild.org/docs/home.html) 스크립트를 사용하여 팩토리오와 모든 라이브러리를 빌드하기 때문입니다. 운 좋게도 Nintendo Switch 문서는 매우 상세합니다. 빌드 시스템의 많은 세부 사항을 이해한 후에, 저는 Nintendo Switch용 팩토리오를 빌드하는 FASTBuild 스크립트를 만들 수 있었습니다.

**2021년 3월 3일** - 저에게는 첫 번째 중요한 단계가 있었는데, 모든 컴파일 오류가 수정되었으며 실행 파일이 올바르게 링크되었습니다.
**2021년 3월 4일** - 전체 게임 패키지를 빌드하고 devkit에서 실행할 수 있었습니다. 시작은 성공했지만 즉시 충돌했습니다.
그 뒤를 이어 창 초기화, 오디오, 파일 시스템 초기화 및 액세스, 네트워크 스택 초기화 처리와 같은 많은 수정 및 기술 문제가 있었습니다. 그리고 문제가 언제 끝날지 알 수 없는 큰 프로젝트에서는 가장 명백한 문제를 수정하고 다음으로 이동한 다음 게임을 다시 실행하고 다음 충돌이나 오류가 어디에서 발생할지 실제로 알지 못한 채 반복했습니다.

**2021년 3월 29일** - 매우 중요한 단계를 거쳤고 로그에는 "1212.940 팩토리오 초기화됨"이라는 글이 나왔습니다. 팩토리오는 성공적으로 메인 화면으로 들어가졌습니다.

[영상 확인하기](https://cdn.factorio.com/assets/img/blog/fff-370-first-run.mp4")

그것은, 특히 모든게 갑자기 진행되는 것처럼 보일 때는, 엄청난 기분이었습니다. 백그라운드 시뮬레이션이 정확이 렌더되었고, 소리와 음악이 흘러나오고, 심지어 터치스크린을 이용한 GUI와의 상호작용도 진행되었습니다. 이제 모든 수정 및 구현이 마침내 표시되었습니다.

### 성능

그러나 예리한 눈을 가진 사람들은 "1212.940 Factorio initialised"의 문제를 알아차릴 수 있었을 것입니다. 1212.940은 초 단위의 타임스탬프입니다. 게임을 로드하고 메인 메뉴에 도달하는 데 20분이 걸린 것입니다...

그것은 디버그 빌드였기 때문에, 숫자는 그렇게 큰 것이 아니었지만, 시작 시간은 저희가 릴리즈 직전까지 다투는 것입니다. 이제 게임이 내부 저장소에 설치되는 최종 시작 시간은 70초이지만 너무 앞서가지는 맙시다.

다음 단계는 명백한 성능 최적화를 모두 수행하고 성능이 충분한지 결정하는 것이었습니다. 해야 할 최적화가 많았지만 개발 도구 덕분에 작업이 더 쉬워졌습니다. 이를 통해 많은 Nintendo Switch 관련 최적화를 수행할 수 있었고 심지어 [PC 버전에 대한 최적화](https://forums.factorio.com/viewtopic.php?f=3&t=101968)도 일부 수행할 수 있었습니다. "성능이 충분 한가?"라는 질문에 대답하는 것은 쉬운 질문이 아닙니다. 왜냐하면 "충분히 좋은" 것이 무엇일까요? 저는 "보통의 플레이어가 로켓을 발사하여 게임을 마칠 수 있어야 하고 게임은 60 UPS를 유지해야 한다"고 정했습니다. 운 좋게도 얼마 되진 않았지만 성능은 목표를 달성했습니다.

### 멀티플레이

그런 식으로, 다음 단계는 멀티플레이어 결정론이었습니다. 한 가지 큰 목표는 게임에서 멀티플레이어를 빼고 싶지 않다는 것이었습니다. 또한 PC 플레이어가 Nintendo Switch 플레이어와 함께 플레이하기를 원했습니다. 게임이 ARM과 x86 사이에서 결정론적인지 확인해야 했던 것은 이번이 처음이었습니다. 아마 괜찮을겁니다. C++는 포터블이니까요. 맞죠? [정의되지 않은 행동](https://en.wikipedia.org/wiki/Undefined_behavior)만 사용하지 않으면 됩니다. 우리는 메인 코드와 라이브러리 모두에서 정의되지 않은 행동을 꽤 많이 사용하는 것으로 나타났습니다. 예를 들어 실수를 정수로 캐스팅할 때 값이 정수에 맞지 않으면 정의되지 않은 동작으로 간주되며 그 결과값은 ARM 및 x86 CPU에서 다릅니다.

정의되지 않은 행동의 모든 사용을 제거하는 것은 아마도 어리석은 짓일 것입니다. 코드 전체에 상당한 변경이 필요하고 시간이 걸리고 성능에 영향을 미치며 즉각적인 실질적인 이점은 없기 때문입니다. 그래서 저는 실제로 결정론을 깨뜨린 정의되지 않은 행동의 사례를 찾았습니다. 결정론을 테스트하는 데 사용하는 도구가 많기 때문에 이것은 충분히 쉬웠습니다. x86과 ARM 사이의 모든 테스트(2,417번의 테스트를 진행함)의 모든 틱에 대한 게임 상태 CRC를 비교함으로써 잠재적인 문제에 대해 꽤 잘 다루고 있다고 생각합니다. 발견된 모든 문제를 수정한 후에도 여전히 일부 멀티플레이어 비동기화가 있을 수 있지만 플레이어는 남아 있는 비동기화를 찾는 데 도움을 주어야 합니다.

### 컨트롤러

다음 주요한 단계는 컨트롤러로 게임을 플레이할 수 있게 하는 것이었습니다. 팩토리오는 10년간 키보드와 마우스만을 염두에 두고서 개발되었습니다. 또한 우리는 146개의 매핑 가능한 옵션을 가지고 있지만, 컨트롤러는 대부분 16개의 버튼과 2개의 조이스틱만을 가지고 있습니다. 저는 제어 체계를 만들려고 하고, 그것들은 다음 조건들을 만족해야 합니다.

* 모든 주요한 동작을 가지고 있으며,
* 입문자와 기존 플레이어에게 모두 직관적이어야 하며,
* 알려진 기준을 만족하며,
* 가장 많이 쓰이는 작업을 빨리 수행할 수 있어야 합니다.

저는 GUI를 다시 디자인하지 않고, 게임의 큰 부분들을 다시 쓰지 않으며 이것들을 만족시켜야 했습니다. 이 모든 것은 이미 충분히 머리아픕니다. 그럼에도 불구하고 프로젝트를 시작하기 전에 이것을 계획하는 데 시간을 보냈기 때문에 합리적으로 가능한지 확인하기 위해 어떻게 해야할지 아이디어가 있었습니다.

### GUI

One of the challenges was how to navigate the GUI. Something that was clearly out of the question was dumbing down the GUI on all platforms for the sake of controllers, like many games do. There are many PC games out there with terrible "console port" GUIs; Factorio's will always be designed with keyboard and mouse in mind first. Another thing that was also out of the question was redoing the GUI for controllers. We have hundreds of GUIs that took years to design and implement, and some are still being changed. Redesigning and changing most of them again would also take years.

문제 중 하나는 GUI를 탐색하는 방법이었습니다. 분명히 의문의 여지가 없었던 것은 많은 게임과 마찬가지로 컨트롤러를 위해 모든 플랫폼에서 GUI를 하향 평준화 시키는 것이었습니다. 끔찍하게 "콘솔로 포팅된" GUI를 사용하는 많은 PC 게임이 있습니다. 팩토리오의 GUI는 항상 키보드와 마우스를 먼저 염두에 두고 설계될 것입니다. 의문의 여지가 없는 또 다른 사항은 컨트롤러용 GUI를 다시 실행하는 것이었습니다. 저희는 설계하고 구현하는 데 수년이 걸린 수백 개의 GUI가 있으며 일부는 여전히 변경 중입니다. 대부분을 다시 디자인하고 변경하는 데에도 몇 년이 걸릴 것입니다.

따라서 남은 유일한 해결책은 대부분 동일한 레이아웃을 사용하고 컨트롤러 스틱을 사용하여 위젯을 탐색하는 것이었습니다. 간단해 보이지만 내부에는 매우 복잡한 휴리스틱 알고리즘이 있습니다. 예를 들어 스틱의 왼쪽을 누르면 알고리즘은 왼쪽에 있는 모든 대화형 위젯을 살펴보고 현재 위젯과 후보 위젯 경계 상자, 위치, 어떤 상위 유형에 속해 있는지, 상위 요소의 경계 상자가 무엇인지 등의 요소를 기반으로 가장 좋은 것을 선택합니다.

다음은 GUI와 상호 작용하는 모습에 대한 짧은 비디오입니다.

[영상 확인하기](https://cdn.factorio.com/assets/img/blog/fff-370-gui-navigation.mp4")

또 다른 중요한 부분은 퀵바를 업데이트하는 것이었습니다. 저는 "빠른 패널"이라는 새로운 UI를 추가했습니다. L(왼쪽 범퍼)를 잡으면 열리며, 아이템, 공구, 패널에 빠르게 접근할 수 있는 방사형 메뉴입니다.

[영상 확인하기](https://cdn.factorio.com/assets/img/blog/fff-370-quick-panel.mp4")

### 마무리

2021년 8월 말 즈음에 게임은 Nintendo Switch에서 완전히 플레이할 수 있었습니다. 저는 원격으로 근무하는데 그 때 모임이 있어서 컨트롤러를 처음으로 플레이하는 사람들에게 얼마나 직관적인지 확인할 수 있도록 다른 팀원들에게 제가 지켜보는 동안 게임을 플레이하도록 요청했습니다. 피드백은 대부분 긍정적이었고 어떤 부분을 개선해야 하는지에 대한 아이디어도 있었습니다.

그리고 그것과 함께, 포팅의 마지막 주요 단계가 끝났습니다. 마무리가 하고 난면, 게임이 2021년 말에 발매될 준비가 되어야 했습니다... 하지만 저희는 2022년 10월 28일에 발매를 하게 됐습니다. 그 사이에 대체 무슨 일이 일어났을까요? 예상하셨다시피, 몇몇이 생각보다 오래걸렸습니다. 90/90 법칙 (혹은 비슷한 것)은 대체로 사실이었습니다. 또한, 저는 앞에서 말했다시피 "빠른 실패"를 원했기 때문에, [Vertical Slice](https://en.wikipedia.org/wiki/Vertical_slice)를 실행해보고 싶었습니다. 이제 돌아가서 모든 것이 제대로 완료되었는지 확인해야 할 때였습니다. 추가로, 아직 다음과 같은 일들이 매우 많이 남아있었습니다.

* 더 많은 테스트와 컨트롤러를 사용한 세련된 플레이
* GUI를 탐색하는 휴리스틱 알고리즘을 조정하여 직관적이고 수백개의 GUI에서 작동하도록 하는 것
* 모든 사용자 지정 GUI 위젯이 컨트롤러와 상호 작용할 수 있는지 확인 (여기에는 스위치, 슬라이더, 기차 미니맵, 장비 그리드 등이 포함됩니다.)
* UPS, FPS 및 로딩 시간에 대한 추가 최적화.
* 진동 추가 실험. Joy-Con 컨트롤러와 Nintendo Switch 프로 컨트롤러는 HD 진동을 지원합니다. 약간의 테스트와 실험을 거친 후 저는 이 기능을 사용하고 경험을 향상시키기 위해 많은 맞춤형 진동을 추가하는 것이 가치가 있다고 결정했습니다.
* 튜토리얼 캠페인, 미니 튜토리얼, 팁 및 전략 업데이트.
* [번역](https://crowdin.com/project/factorio/discussions/214)
* 이용 연령 심사
* Nintendo Switch 이용자들의 빠른 인증을 위한 인게임과 서버 백엔드의 변경
* [Bugs](https://cdn.factorio.com/assets/img/blog/fff-370-bug.mp4)
* 구현 및 Nintendo의 요구 사항이 충족되었는지 확인합니다. 게임 콘솔에서 게임을 출시한다는 것은 많은 요구 사항을 준수하고 검토 프로세스를 거쳐야 함을 의미합니다.

출시 후에도 할 일이 많습니다. 제 화면 옆에는 향후 개선 사항, 가능한 기능 및 해결해야 할 기술 부채가 포함된 포스트잇 더미가 있습니다. 지난 주 발표에서 언급했듯이, 출시 후에 PC 및 Steam Deck에 대한 컨트롤러 지원도 작업할 예정입니다.

그것은 대부분 저의 서브 프로젝트 였고 나는 그것에 풀 타임으로 일하는 유일한 사람이었습니다. 저는 나머지 팀이 확장에 집중하고 방해하지 않도록 하려고 노력했지만 다른 사람들은 그래픽 최적화, 오디오 최적화, 웹 백엔드, 테스트, 플레이 테스트, 피드백 및 기타 작은 작업과 같은 몇 가지 일에서 저를 도왔습니다. 모든 것과 마찬가지로 팀의 노력이었습니다. 또한 Nintendo의 많은 담당자가 출시 및 개발에 대한 지원을 제공했습니다. Nintendo Direct만큼 큰 이벤트에 참여하게 되어 영광이었습니다.

---

### 좋은데, 확장은요? (kovarex)

It wouldn't be fair to not address the elephant in the room, which is the progress on the expansion. We have been working hard on it and have a lot of progress, but still haven't shared any specifics for the strategic reasons mentioned previously.

In the [FFF-367](./367.md) we specified that we are in Step 4, and now we can say, that we are somewhere deep in Step 5. First, I had a playthrough from start to finish, where we had to assemble and fix systems on the go. It was very rough and long, partially because I had to repeatedly update the factory as we implemented changes.

But the result was the game being playable from start to finish. Having a "skeleton" of the playthrough was critical for managing the team, as people could more efficiently split their effort into more independent sections of the game.

The second playthrough was a week-long office LAN-party in July 2022, where 12 people spent 5 full days racing to finish the game before the end of the week. Some of us took family vacations because of this, so we tried to get the most out of it. You can imagine how intense it was, and how destroyed we were at the end. But it was a great experience, and playing one playthough in one continuous session, gave us an accurate feeling of the overall pacing. The key takeaway was that the game was too long, and some parts were too boring or repetitive.

Since then, we mainly focused on fixing the problems identified. Also, a lot of the things we used in the playthrough technically work, but its look and feel is very simplified as it is a prototype. Imagine an inserter prototype which moves things from A to B, but it is a grey square and doesn't swing its arm. This is the state of a lot things at the moment.

The reason why we still don't share specific details is, that we have to sadly inform you, that it still won't be ready sooner than in a year from now. Once the estimates get reasonably close, we will start dropping some FFFs.

---

As always, you can let us know what you think at the usual places.
